/*
	Date Converter jQuery plugin by Mahesh Maharjan 2015
	http://www.mahesh247.com.np
*/
(function(d){d.Converter=function(b){this.$el=d(b);this._init()};d.Converter.defaults={e_base_YY:1944,e_base_MM:1,e_base_DD:1,n_base_YY:2E3,n_base_MM:9,n_base_DD:17,ord_month:[31,28,31,30,31,30,31,31,30,31,30,31],leap_month:[31,29,31,30,31,30,31,31,30,31,30,31],eMonth:"January February March April May June July August September October November December".split(" "),nMonth:"\u092c\u0948\u0936\u093e\u0916 \u091c\u0947\u0937\u094d\u0920 \u0905\u0938\u093e\u0930 \u0936\u094d\u0930\u0935\u0923 \u092d\u093e\u0926\u094d\u0930 \u0905\u0938\u094b\u091c \u0915\u093e\u0930\u094d\u0924\u093f\u0915 \u092e\u0919\u094d\u0938\u093f\u0930 \u092a\u094c\u0937 \u092e\u093e\u0918 \u092b\u093e\u0917\u0941\u0928 \u091a\u0948\u0924\u094d\u0930".split(" "), nNum:"\u0966\u0967\u0968\u0969\u096a\u096b\u096c\u096d\u096e\u096f".split(""),weekDays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),nweekDays:"\u0906\u0907\u0924\u092c\u093e\u0930 ;\u0938\u094b\u092e\u092c\u093e\u0930;\u092e\u0919\u094d\u0917\u0932\u092c\u093e\u0930;\u092c\u0941\u0927\u092c\u093e\u0930;\u092c\u093f\u0939\u0940\u092c\u093e\u0930;\u0936\u0941\u0915\u094d\u0930\u092c\u093e\u0930;\u0936\u0928\u093f\u092c\u093e\u0930".split(";")};d.Converter.prototype={_init:function(){this.options= d.extend(!0,{},d.Converter.defaults);(function(){var b=null;d.ajax({async:!1,global:!1,url:"json/dates.json",dataType:"json",success:function(c){b=c}});return b})();e_diff=this.options.e_base_YY;n_diff=this.options.n_base_YY;var b=new Date,h=b.getFullYear(),e=b.getMonth(),b=b.getDate(),c=[];j=0;for(i=1944;2050>=i;i++,j++)c[j]=i;this.engYear;this.eYear=c;h=this._getCurrent(h,e+1,b);this._today(h[0],h[1]-1,h[2])},_leapYear:function(b){return 0==b%4?!0:!1},_countDaysAD:function(b,d,e){var c=0;for(i= 0;i<b-e_diff;i++)if(!0===this._leapYear(e_diff+i))for(j=0;12>j;j++)c+=this.options.leap_month[j];else for(j=0;12>j;j++)c+=this.options.ord_month[j];for(i=0;i<d-1;i++)c=!0===this._leapYear(b)?c+this.options.leap_month[i]:c+this.options.ord_month[i];return c+=parseInt(e)},_countDaysBS:function(b,h,e){var c=function(){var b=null;d.ajax({async:!1,global:!1,url:"json/dates.json",dataType:"json",success:function(c){b=c}});return b}(),f=0;i=0;for(n=n_diff;i<b-n_diff;i++)for(yr=c[n],n++,j=1;12>=j;j++)f+= yr[j];yr=c[b];for(j=1;j<h;j++)f+=yr[j];return f+=parseInt(e)},_englishToNepali:function(b){for(var h=0,e=5,c=j=9,f=16,g=2E3,k=function(){var b=null;d.ajax({async:!1,global:!1,url:"json/dates.json",dataType:"json",success:function(c){b=c}});return b}();0!=b;){var l=k[g];f++;e++;f>l[j]&&(j++,c++,f=1,firstDay=7==e?0:e);6<e&&(e=0);if(12<c||12<j)g++,c=1,h++,j=1;b--}numDay=e;return[g,c,f,e]},_nepaliToEnglish:function(b){for(var d=0,e=2,c=0,f=0,g=13,c=3,f=1943;0!=b;)d=!0===this._leapYear(f)?this.options.leap_month[c]: this.options.ord_month[c],g++,e++,g>d&&(c++,g=1,12<=c&&(f++,c=0)),6<e&&(e=0),b--;return[f,c,g,e]},_today:function(b,h,e){var c=new Date,f=c.getFullYear(),g=c.getMonth(),c=c.getDate();d.each(this.eYear,function(b,c){c==f?d("select#eYY").append('<option selected="selected" value="'+c+'">'+c+"</option"):d("select#eYY").append('<option value="'+c+'">'+c+"</option")});d.each(this.options.eMonth,function(b,c){b==g?d("select#eMM").append('<option selected="selected" value="'+b+'">'+c+"</option"):d("select#eMM").append('<option value="'+ b+'">'+c+"</option")});month_length=(new Date(f,g+1,0)).getDate();for(m_days=1;m_days<=month_length;m_days++)m_days==c?d("select#eDD").append('<option selected="selected" value="'+m_days+'">'+m_days+"</option"):d("select#eDD").append('<option value="'+m_days+'">'+m_days+"</option");j=0;for(a=2E3;2090>=a;a++,j++)a==b?d("select#nYY").append('<option selected="selected" value="'+a+'">'+this._engToNepDigit(a)+"</option"):d("select#nYY").append('<option value="'+a+'">'+this._engToNepDigit(a)+"</option"); d.each(this.options.nMonth,function(b,c){b==h?d("select#nMM").append('<option selected="selected" value="'+b+'">'+c+"</option"):d("select#nMM").append('<option value="'+b+'">'+c+"</option")});nepY=d("select#nYY").val();nepM=d("select#nMM").val();nYear=function(){var b=null;d.ajax({async:!1,global:!1,url:"json/dates.json",dataType:"json",success:function(c){b=c}});return b}()[nepY];nMonthLength=nYear[parseInt(nepM)+1];for(nm_days=1;nm_days<=nMonthLength;nm_days++)nm_days==e?d("select#nDD").append('<option selected="selected" value="'+ nm_days+'">'+this._engToNepDigit(nm_days)+"</option"):d("select#nDD").append('<option value="'+nm_days+'">'+this._engToNepDigit(nm_days)+"</option")},_getCurrent:function(b,d,e){return newNDate=this._englishToNepali(this._countDaysAD(b,d,e))},_engToNepDigit:function(b){b=""+b;for(var d="",e=0;b.length>e;e++)d+=this.options.nNum[b[e]];return d},convertToBS:function(b,d,e){newNDate=this._englishToNepali(this._countDaysAD(b,d,e));return this._engToNepDigit(newNDate[0])+", "+this.options.nMonth[newNDate[1]- 1]+", "+this._engToNepDigit(newNDate[2])+" - "+this.options.nweekDays[newNDate[3]]},convertToAD:function(b,d,e){newEDate=this._nepaliToEnglish(this._countDaysBS(b,d,e));return newEDate[0]+", "+this.options.eMonth[newEDate[1]]+", "+newEDate[2]+" - "+this.options.weekDays[newEDate[3]]}};d.fn.myConverter=function(){var b=d.data(this,"converter");this.each(function(){b?b._init():b=d.data(this,"converter",new d.Converter(this))});return b}})(jQuery);